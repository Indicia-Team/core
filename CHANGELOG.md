# Version 2.9.0
*2019-02-22*

* Adds a download folder to warehouse for temporary generated download files.
* REST API ElasticSearch proxy supports the Scroll API for generation of large downnload files in chunks.
* REST API ElasticSearch proxy supports formatting output as CSV.
* Fix REST API JSON output so that zeros are not excluded.
* Improvements to ElasticSearch document format.
* Updates to reports for Splash.

# Version 2.8.0
*2019-02-15*

* ElasticSearch output reports now include custom attributes data.
* Fixes a syntax error in spatial indexing SQL statements.

# Version 2.7.0
*2019-02-13*

* Saving a record slightly faster, because ap square updates are done in a single update
  statement rather than one per square size.
* Saving records also slightly faster due to reduced number of update statements that are
  run on the cache tables.
* New tracking field to store an autogenerated sequential system unique update ID in
  cache_occurrences_functional and cache_samples_functional. This makes it easier to
  track any changes to the cache tables, e.g. for feeding changes through to other
  systems such as Elasticsearch. It also makes change tracking of system generated
  changes (such as spatial indexing) seperate to user instigated record changes so that
  notifications are not unnecessarily generated for the former.
* New standard reporting parameters `tracking_from` and `tracking_to` for filtering on
  change tracking IDs.
* REST API uses tracking data rather than updated_on field when using autofeed mode to
  autogenerate a feed of updates.
* Spatial indexing no longer changes cache table updated_on fields therefore does not
  fire notifications.
* Fixes a problem in the update kit with a missing class file
  (https://github.com/Indicia-Team/warehouse/issues/315)

# Version 2.6.0
*2019-02-07*

* New indexed_location_type_list standard parameter for reports. Allows
  filtering to any record which is indexed against a site of the given type(s).
* Uploading locations from SHP file now generates work queue entries correctly
  for updates as well as inserts.
* Spatial indexer updates the cache table updated_on fields when changing the
  location_ids field in the cache. This makes it easier to pass changes through
  to feeds such as Elasticsearch.

# Version 2.5.0
*2019-02-05*

## Database schema changes

* Terms.term field is now unlimited length.

## Other changes

* Fixes a bug saving attribute values that contain ranges.
* Fixes a bug where an existing deleted attribute value prevented others from
  being saved.
* Support for a restricted attribute in report files for reports which are only
  available to RESTful API clients which have been explicitly authorised to use
  them.
* Updated_on flag is updated after a taxonomy update in the associated
  cache_occurrences_functional records. Previuosly a taxon name change or
  similar would not cause the updated_on field to be updated making change
  tracking harder.
* A parameter request in a report result no longer prevents the report output
  from being counted.
* Elasticsearch population reports updated (better performance and document
  structure, restricted access where appropriate).

# Version 2.4.0
*2019-01-21*

* Support for proxy requests to an Elasticsearch cluster, with authentication &
  authorisation support in the RESTful API. See
  https://indicia-docs.readthedocs.io/en/latest/developing/rest-web-services/elasticsearch.html and
  https://github.com/Indicia-Team/support_files/blob/master/Elasticsearch/README.md.


# Version 2.3.0
*2019-01-09*

## Database schema changes

* Add the following cache fields:
  * cache_occurrences_functional.verification_checks_enabled
  * cache_occurrences_functional.parent_sample_id
  * cache_samples_functional.parent_sample_id
* Update many reports to avoid need to join to websites table since
  verification_checks_enabled now in cache.
* Cache table location_ids field now stores an empty array when the associated
  sample is not linked to any indexed locations rather than null, allowing
  records not yet indexed to be identifiable.

# Version 2.2.0
*2018-12-19*

* Enable use of a scratchpad list of species as a standard filter parameter.

# Version 2.1.0
*2018-12-18*

* Enable import of occurrences where the taxon is identified using a known
  taxa_taxon_list_id.

# Version 2.0.0
*2018-12-14*

Please see [upgrading to version 2.0.0](UPGRADE-v2.md).

## Warehouse user interface changes

* Warehouse client helper and media code libraries updated to use jQuery 3.2.1
  and jQuery UI 1.12.
* Overhaul the warehouse UI with a new Bootstrap 3 based theme and more logical menu
  structure.
* Warehouse home page now has additional help for getting started and diagnosing
  problems.

## Back-end changes

* Support for PostgreSQL version 10.
* Support for PHP 7.2.
* Support for prioritised load aware background task scheduling via a work queue module.

## Database schema changes

* Removed the following:
  * index_locations_samples table
  * fields named location_id_* from cache_occurrences_functional
  * fields named location_id_* from cache_samples_functional
  Replaced the above with cache_occurrences_functional.location_ids (integer[]) and
  cache_samples_functional.location_ids (integer[]). This means there is no need to
  distinguish between uniquely indexed location types (linked via the locaiton_id_*
  fields) and non-uniquely indexed location types (linked in the index_locations_samples
  table). Removes the need for additional join to index_locations_samples so will improve
  performance in many cases.
* Attribute values for taxa, samples and occurrences are now stored in the relevant
  reporting cache tables in a JSON document (attrs_json field). This means that reports
  can output custom attribute values for a record without additional joins for each
  attribute. To enable this functionality, the report needs a parameter of type taxattrs,
  smpattrs or occattrs (allowing attributes to include to be dynamically declared in a
  parameter). Then provide a parameter useJsonAttributes set to a value of '1' to enable
  the new method of accessing attribute values. This has the potential to improve
  performance significantly for reports which include many different attribute values in
  the output.
* New cache_taxon_paths which provides a hierarchical link between taxa and all their
  taxonomic parents.
* Cache_occurrences_functional now has a taxon_path field which links to the parent taxa
  for the record, as defined by the main taxon list configured on the warehouse.
* Reports no longer need to join via users to check the sharing/privacy settings of a
  user. Any sharing task codes which are not available for the user are listed in
  cache_*_functional.blocked_sharing_tasks.
* Support for dynamic attributes, i.e custom sample or occurrence attributes which are
  linked to a taxon. They can then be included on a recording form only when entering a
  taxon that is, or is a descendant of, the linked taxon.

## Report updates

* Updated reports which used the location_id_* fields to output a location for a record
  to now update a list of overlapping locations rather than being limited to a single
  location. For example, if a record is added which overlaps 2 country boundaries then
  the report may include both country names in the output field rather than just one.
* Removed the following unused verification reports. Existing verification
  implementations on client websites should be updated to use the verification_5 prebuilt
  form and its reports:
  * reports/library/occurrences/verification_list.xml
  * reports/library/occurrences/verification_list_2.xml
  * reports/library/occurrences/verification_list_3.xml
  * reports/library/occurrences/verification_list_3_mapping.xml
  * reports/library/occurrences/verification_list_3_mapping_using_spatial_index_builder.xml
  * reports/library/occurrences/verification_list_3_using_spatial_index_builder.xml
* Other unused reports removed:
  * reports/library/locations/filterable_occurrence_counts_mappable_2.xml
  * reports/library/locations/filterable_species_counts_mappable_2.xml
