<report
    title="Verification Template list"
    description="A list of verification templates appropriate for a taxa_taxon_list_id."
>
  <query website_filter_field="o.website_id" count_field="vt.id">
  SELECT #field_sql#
  FROM list_verification_templates vt
  LEFT JOIN cache_taxa_taxon_lists cttl
    ON cttl.id = #taxa_taxon_list_id#
  LEFT JOIN cache_taxa_taxon_lists family_cttl
    ON family_cttl.id = cttl.family_taxa_taxon_list_id
  #joins#
  WHERE (vt.restrict_to_website_id = 'f' OR '#website_id#' = CAST(vt.website_id AS character varying))
    AND (((array_length(vt.restrict_to_external_keys, 1)=0 OR vt.restrict_to_external_keys IS NULL)
            AND (array_length(vt.restrict_to_family_external_keys, 1)=0 OR vt.restrict_to_family_external_keys IS NULL))
      OR (array_length(vt.restrict_to_external_keys, 1)>0
            AND cttl.external_key = ANY(vt.restrict_to_external_keys)
            AND cttl.id IS NOT NULL)
      OR (array_length(vt.restrict_to_family_external_keys, 1)>0
            AND family_cttl.external_key = ANY(vt.restrict_to_family_external_keys)
            AND family_cttl.id IS NOT NULL))
  #order_by#
  </query>
  <field_sql>
    vt.id as id, 
    vt.template
  </field_sql>
  <order_bys>
    <order_by>vt.id</order_by>
  </order_bys>
  <params>
    <param name='taxa_taxon_list_id' display='Taxon ID' description='ID of the taxon to fetch templates for' datatype='integer'/>
  </params>
  <columns>
    <column name='id' display='ID' />
    <column name='template' display='Template' />
  </columns>
</report>