<report
    title="Results overview - taxonomic output"
    description="A report to display the taxon group details on the Results Overview page."
>
<query website_filter_field="o.website_id">
  SELECT #columns#
  FROM cache_occurrences o
  JOIN taxa_taxon_list_attribute_values ttlav on ttlav.taxa_taxon_list_id=o.preferred_taxa_taxon_list_id
      and ttlav.taxa_taxon_list_attribute_id in (#taxa_taxon_list_trait_attr_ids#)
      and ttlav.deleted=false
  WHERE o.sample_id = #sample_id#
  </query>
  <params>
    <param name='sample_id' display='Sample' description='Sample id to retrieve data for.' datatype='integer'/>
    <param name='taxa_taxon_list_trait_attr_ids' display='Trait Attribute Ids' description='Comma separated in of the attribute ids that hold species traits.' datatype='text'/>
  </params>
  <columns>
    <column name='taxon_group_id' sql='o.taxon_group_id' display='Taxon Group ID' in_count='true' visible='false'/>
    <column name='taxon_group_title' sql='o.taxon_group' display='Taxon Group Title'/>
    <column name='count' sql='count(distinct o.preferred_taxa_taxon_list_id)' display='count' aggregate='true'/>
  </columns>
</report>