<report
    title="HORUS quality index breakdown"
    description="Breakdown of values for an HORUS quality index."
    >
  <query>
    select #columns#
    from taxa_taxon_list_attribute_values ttlav
    join cache_occurrences o on o.preferred_taxa_taxon_list_id=ttlav.taxa_taxon_list_id
    where ttlav.deleted=false
    and ttlav.taxa_taxon_list_attribute_id=#attr_id#
    and o.sample_id=#sample_id#
  </query>
  <order_bys>
    <order_by>ttlav.text_value ASC</order_by>
  </order_bys>
  <params>
    <param name='attr_id' display='Taxa taxon list attribute ID'  datatype='integer'/>
    <param name='sample_id' display='Sample ID'  datatype='integer'/>
  </params>
  <columns>
    <column name="grade" sql="coalesce(ttlav.text_value, ttlav.int_value::varchar)" display="Grade" />
    <column name="no_of_species" sql="count(distinct ttlav.taxa_taxon_list_id)" display="Number of species" aggregate="true" />
  </columns>

</report>