<report
    title="Trait Species List"
    description="A report which lists all the species associated with an OSIRIS trait."
    >
  <query website_filter_field="o.website_id">
    select #columns#
    from taxa_taxon_list_attribute_values ttlav
    join cache_occurrences o on o.preferred_taxa_taxon_list_id=ttlav.taxa_taxon_list_id
    join cache_taxa_taxon_lists ttl on ttl.id=o.taxa_taxon_list_id
    where ttlav.deleted=false
    and ttlav.taxa_taxon_list_attribute_id=#trait_attr_id#
    and ttlav.int_value=#trait_term_id#
    and o.sample_id=#sample_id#
    #filters#
  </query>
  <order_bys>
    <order_by>o.taxon_group</order_by>
  </order_bys>
  <params>
    <param name='sample_id' display='Sample' description='Sample id to retrieve data for.' datatype='integer'/>
    <param name='trait_attr_id' display='Ecological Division/Habitat or Resource Attribute Id' description='Trait attribute id for Ecological Division, Habitat or Resource.' datatype='integer'/>
    <param name="trait_term_id" display="Parent trait term ID" datatype="integer" />
  </params>
  <columns>
    <column name="species" sql="o.taxon" display="Species" />
    <column name="taxon_group" sql="o.taxon_group" display="Group" />
    <column name="family" sql="ttl.family_taxon" display="Family" />
    <column name="status" display="Status"
            sql="case when o.taxon=o.default_common_name then 'Vernacular' when o.taxa_taxon_list_id=o.preferred_taxa_taxon_list_id then 'primary name' else 'synonym' end" />
  </columns>
</report>