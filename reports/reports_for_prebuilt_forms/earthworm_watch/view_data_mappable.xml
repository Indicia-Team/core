<report
    title="View Data"
    description="Report to display the map on the View Data page on Earthworm Watch."
>
  <query website_filter_field="su.website_id">
  SELECT #columns#
  FROM samples s
  JOIN surveys su on su.id=s.survey_id and su.id = #survey_id# and su.deleted=false
  JOIN websites w on w.id=su.website_id and w.deleted=false
  LEFT JOIN locations l on l.id=s.location_id and l.deleted=false
  WHERE 
  #website_filter#
  AND s.deleted=false
  </query>
  <params>
    <param name='survey_id' display='Survey ID' description='ID of the survey to show data for.' datatype='int'/>
  </params>
  <columns>
    <column name='sample_id' display='ID' sql='s.id' datatype="integer"/>
    <column name='location_name' display='Site name' sql='s.location_name' datatype="text" />
    <column name='entered_sref' display='Grid ref' sql="s.entered_sref" datatype="text" />
    <column name='date_start' sql='s.date_start' visible='false' />
    <column name='date_end' sql='s.date_end' visible='false' />
    <column name='date_type' sql='s.date_type' visible='false' />
    <column name='date' display='Date' datatype="date" />
    <column name="geom" visible="false" mappable="true" sql="st_astext(s.geom)" in_count="true" />
  </columns>
</report>