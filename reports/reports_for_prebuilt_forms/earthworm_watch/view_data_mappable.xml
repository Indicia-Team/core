<report
    title="View Data"
    description="Report to display the map on the View Data page on Earthworm Watch. Respects privacy precision."
>
  <query website_filter_field="csf.website_id">
  SELECT #columns#
  FROM cache_samples_functional csf
  JOIN cache_occurrences_functional cof on cof.website_id=csf.website_id and cof.survey_id=csf.survey_id and cof.sample_id=csf.id
  WHERE 
  csf.survey_id = #survey_id#
  AND #website_filter#
  AND ((cof.training=false AND #training_records#!=1) or (cof.training=true AND #training_records#=1))
  </query>
  <params>
    <param name='survey_id' display='Survey ID' description='ID of the survey to show data for.' datatype='int'/>
    <param name='training_records' display='Training records?' description='Show training records instead?.' datatype='int' emptyvalue='0' default='0'/>
  </params>
  <columns>
    <column name='sample_id' display='Sample ID' sql='csf.id' datatype="integer"/>
    <column name="geom" visible="false" mappable="true" sql="st_astext(csf.public_geom)" in_count="true" />
  </columns>
</report>