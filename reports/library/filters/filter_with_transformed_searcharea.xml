<report
    title="Filter info (transformed searchArea)"
    description="Filter with extra searchArea column transformed to EPSG:4326 for use in Elasticsearch queries."
>
  <query>
  SELECT #columns#
  FROM filters f
  WHERE (f.website_id in (#website_ids#) or f.website_id is null)
  AND f.deleted=false
  and f.id=#filter_id#
  #order_by#
  </query>
  <order_bys>
    <order_by>f.title ASC</order_by>
  </order_bys>
  <param name="filter_id" data_type="integer" />
  <columns>
    <column name="id" visible="false" sql="f.id" />
    <column name="title" display='Title' datatype="text" sql="f.title" />
    <column name="description" display='Description' datatype="text" sql="f.description" />
    <column name="sharing" datatype="text" display="For task"
        sql="case f.sharing when 'R' then 'Reporting' when 'P' then 'Peer review' when 'V' then 'Verification'
        when 'D' then 'Data flow' when 'M' then 'Moderation' when 'E' then 'Editing' end"/>
    <column name="definition" visible="false" sql="f.definition" />
    <column name="defines_permissions" visible="false" sql="f.defines_permissions" />
    <column name="search_area"
        sql="definition::json->>'searchArea', st_astext(st_transform(st_geomfromtext(definition::json->>'searchArea', 3857), 4326))" />
  </columns>
</report>

