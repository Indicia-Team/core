<report
    title="Report for triggers against NNSS alert species on the map"
    description="Lists the most recent recordings for
      all species in the survey."
>
  <query>
  SELECT #field_sql#
  FROM cache_occurrences co
  WHERE ((
      (co.website_id = 3 AND 
       co.taxon_meaning_id IN (10,62,63,64,65,66,67,68,69,70,71,72,73,74,75,77,129053,129054))
    ) OR (
      (co.website_id = 23 AND 
       co.taxon_meaning_id IN (117824,116158,114344,116111,115296,117795,114345,114193,115015,117559,117574,117509,116926,116349,115222,114671,115306,129058,117847,117851))
    ) OR (
      (co.website_id = 23 AND 
       co.taxon_meaning_id IN (97131,19763,68122,68971,41788,38421,91237,72435,63841,104860,77225,97224,42913))
    ))
  AND co.survey_id = 13
  GROUP by co.taxon
  </query>
  <field_sql>
	co.taxon,
        COUNT(NULLIF(zero_abundance, false)) AS num_absence,
        COUNT(NULLIF(zero_abundance, true)) AS num_presence,
        (COUNT(co.id) - COUNT(NULLIF(record_status, 'V'))) AS num_verified,
        COUNT(NULLIF(images, '') || NULLIF(record_status, 'V') || NULLIF(record_status, 'R')) AS num_waiting  
  </field_sql>
  <order_bys>
    <order_by>num_presence DESC</order_by>
  </order_bys>
  <columns>
    <column name="taxon" display="Taxon" />
    <column name="num_absence" display="Absence records" />
    <column name="num_presence" display="Submitted records" />
    <column name="num_verified" display="Verified records" />
    <column name="num_waiting" display="Awaiting verification" />
  </columns>
</report>