<report
    title="Alert Verification"
    description="Lists all occurrences for given survey and status"
    row_class="biota"
>
  <query>
  SELECT 
    s.id AS sample_id,
    t.taxon,
    s.date_start AS sample_date,
    (
      COALESCE(
      ((SELECT text_value FROM sample_attribute_values
       WHERE sample_id = s.id AND sample_attribute_id = 5)|| ' '), '')
      ||
      (SELECT text_value FROM sample_attribute_values
       WHERE sample_id = s.id AND sample_attribute_id = 6)
      || ' ' ||
      (SELECT text_value FROM sample_attribute_values
       WHERE sample_id = s.id AND sample_attribute_id = 7)
    )AS name,
    (SELECT text_value FROM sample_attribute_values
       WHERE sample_id = s.id AND sample_attribute_id = 8) AS email,
    (SELECT text_value FROM sample_attribute_values
       WHERE sample_id = s.id AND sample_attribute_id = 20) AS telephone,
    s.entered_sref as spatial_reference,
    s.location_name,
    o.comment AS occ_comment,
    oi.path,
    su.website_id,
    o.id as occurrence_id
  FROM samples s
  JOIN occurrences o ON o.sample_id=s.id AND o.deleted = false
  LEFT JOIN occurrence_images oi ON oi.occurrence_id=o.id
  JOIN surveys su ON s.survey_id = su.id
  JOIN taxa_taxon_lists ttl ON ttl.id = o.taxa_taxon_list_id
  JOIN taxa t ON t.id = ttl.taxon_id
  WHERE (su.id=#survey# or #id#&lt;&gt;0)
  AND (o.record_status = '#record_status#' OR #id#&lt;&gt;0)
  AND (s.id=#id# OR #id# = 0)
  AND o.zero_abundance = FALSE
  AND s.deleted = false
  #order_by#
  </query>
  <order_bys>
    <order_by>s.id DESC</order_by>
  </order_bys>
  <params>
    <param name='id' display='Record ID' description='Enter the ID of a record to view or leave blank for all records.' datatype='integer' emptyvalue='0' />
    <param name='survey' display='Survey' description='Select the survey to return data for (not applicable when viewing a single record by ID).' datatype='lookup'
        query='SELECT id, title as caption FROM surveys' population_call='direct:survey:id:title' emptyvalue='0' />
    <param name='record_status' display='Record Status' description='Select the record status to view data for (not applicable when viewing a single record by ID).' datatype='lookup'
        lookup_values='C:New,S:Sent for verification,V:Verified,R:Rejected' />
  </params>
  <columns>
    <column name='sample_id' display='ID' />
    <column name='taxon' display='Taxon'/>
    <column name='sample_date' display='Date'/>
    <column name="name" display="Name" />
    <column name="email" display="Email" />
    <column name="telephone" display="Tel." />
    <column name='spatial_reference' display='Spatial Ref.' />
    <column name='location_name' display='Location' />
    <column name="occ_comment" display="Comment" />
    <column name='path' display='Photo' img='true' />
    <column name='website_id' visible='false' />
    <column name="occurrence_id" visible="false" />
  </columns>
</report>